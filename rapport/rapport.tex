\documentclass[a4paper]{article}
\title{TP1 : Ghostbusters \protect\\ Programmation temps-réel}
\author{Groupe 2 \\ Orphée Antoniadis \hspace{0.5cm} Raed Abdennadher \hspace{0.5cm} Steven Liatti}
\usepackage[francais]{babel}
\usepackage{fontspec}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{enumitem}
\usepackage{minted}
\usemintedstyle{colorful}
\setlength{\parindent}{0pt}
\usepackage[left=2.5cm,top=2.5cm,right=2.5cm,bottom=2.5cm]{geometry}

\begin{document}
\maketitle
\newpage

\section{Introduction}
Le but de ce travail était de réaliser un jeu qui est un mélange entre deux
anciens jeux vidéo : le Pacman et le Casse-brique. L'objectif était d'apprendre
à utiliser un RTOS et de comprendre son fonctionnement en mode coopératif. Pour
se faire nous avions à disposition la carte Mylab2 accompagnée de la librairie
FreeRTOS contenant les primitives du RTOS ainsi que la librairie myLab\_lib contenant
des fonctions utilitaires pour communiquer avec les périphériques de la carte.

\section{Intêret de l'utilisation d'un RTOS}
%Steven ?
*Expliquez brièvement, selon vous, l’intérêt à utiliser un RTOS dans le cadre de ce projet.

\section{Structure du programme}
%Raed ?
*faire un shéma bloc*

\section{Description des tâches}
\subsection{Gestion du jeu}
\inputminted[breaklines,breaksymbol=,linenos,frame=single,stepnumber=5,tabsize=2,firstline=53,lastline=64]{C}{../workspace/ghostbuster_02/src/game.c}
Lorsque la partie commence, le joueur dois appuyer sur le joystick pour
commencer le jeu et lancer la balle. C'est cette tâche qui s'occupe de la
gestion de cette fonctionnalité. Pour détécter la pression du joystick, nous avons
été obligé de passer par une attente "semi-passive". La tâche va vérifier toutes
les 10ms l'état du joystick puis se mettre en attente passive et laisser la main
aux autres tâches. Lorsque la joystick est appuyé, la tâche initialise le nombre
de vies ainsi que le score du joueur, sort de sa boucle, débloque le sémaphore
sur lequel attendait la tâche de la balle puis attend lui  même sur un autre
sémaphore qui sera débloqué lorsque le joueur aura perdu la balle 3 fois.

\subsection{Gestion de la balle}
\inputminted[breaklines,breaksymbol=,linenos,frame=single,stepnumber=5,tabsize=2,firstline=136,lastline=152]{C}{../workspace/ghostbuster_02/src/ball.c}
%Orphée ?

\subsection{Déplacement des fantômes}
\inputminted[breaklines,breaksymbol=,linenos,frame=single,stepnumber=5,tabsize=2,firstline=236,lastline=271]{C}{../workspace/ghostbuster_02/src/ghosts.c}
%Steven ?

\subsection{Gestion de la raquette}
\inputminted[breaklines,breaksymbol=,linenos,frame=single,stepnumber=5,tabsize=2,firstline=76,lastline=89]{C}{../workspace/ghostbuster_02/src/racket.c}
%Raed ?

\section{Analyse des traces}
%Tous les 3 ?

\section{Limite du nombre de fantômes}
%Tous les 3 ?
Ralentissement du jeu avec un nombre de traces élevée. La fonction de récupération
des traces n'est pas assez performante et le buffer prend un certain temps pour
se vider.
\newline
Le jeu reste bloqué lors de plus de 21 tâches en parallèle. Nous pensons que cette
limite vient de la mémoire alouée à FreeRTOS. AU delà de 21 tâches, on dépasse cette
mémoire définie par la macro configTOTAL\_HEAP\_SIZE définie ici à 20 * 1024. En augmentant
cette variable nous pouvons augmenter le nombre de fantomes jusqu'à la limite
de la mémoire de la carte. La limite que nous avons atteint est de configTOTAL\_HEAP\_SIZE = 27 * 1024
avec un nombre de tâches de 29 (sans compter VApplicationIdleHook). Au dessus nous
avons un hardfault que nous pensons être due à un dépassement de mémoire de la carte.



\end{document}
